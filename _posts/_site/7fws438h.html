<blockquote>
  <p>摘要：计算机基础之数据库，包括SQL语句书写，数据类型，索引/锁，MySQL等。</p>
</blockquote>

<!-- more -->

<h2 id="sql数据库">SQL数据库</h2>

<h3 id="基本概念">基本概念</h3>

<p>元组：表中的一行/一条记录
候选码：能唯一标识元组的列/属性？</p>

<p>主码/主键：用于唯一标识一个元组，不能重复，不允许为空，一个表只能有一个主键。
外码/外键：用来和其他表建立联系，是另一表的主键，可重复，可为空值。一个表可有多个外键。</p>

<p>外键与级联更新：适用于单机低并发，不适合分布式、高并发集群; 级联更新是强阻塞，存在数据库更新风暴的风 险; 外键影响数据库的插入速度</p>

<p>E-R 图/实体-联系图：提供表示实体类型、属性和联系的方法。</p>
<ul>
  <li>1 对 1（1:1）</li>
  <li>1 对多（1: N）</li>
  <li>多对多（M: N）</li>
</ul>

<p><img src="assets/E-R图示例.png" alt="" /></p>

<h5 id="数据库范式">数据库范式</h5>

<p>用于规范建表，划分字段</p>

<ol>
  <li>
    <p>1NF(第一范式)：属性（表中的字段）不可再分（为其他字段），是所有关系型数据库的最基本要求，即创建的表一定满足第一范式。</p>
  </li>
  <li>
    <p>2NF(第二范式)：在第一范式的基础上增加主键，非主属性都依赖于主键。消除了非主属性对于码的<strong>部分函数依赖</strong>。</p>
  </li>
  <li>
    <p>3NF(第三范式)：消除了非主属性对于码的<strong>传递函数依赖</strong>。基本上解决了数据冗余过大，插入异常，修改异常，删除异常的问题。</p>
  </li>
</ol>

<h3 id="sql语句的书写基本使用">SQL语句的书写/基本使用</h3>

<ul>
  <li>数据库操作</li>
  <li>表操作</li>
  <li>
    <ul>
      <li>创建表(create table)</li>
    </ul>
  </li>
</ul>

<h5 id="数据操作增删改查">数据操作/增删改查</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- 
INSERT user_info [name, age] VALUES ("Tom", 21)
INSERT user_info name="Tom", age=21

--
SELEECT age FROM user_info WHEN name="Tom"

--
DELETE FROM user_info

--
UPDATE user_info SET age=22 when name="Tom"
</code></pre></div></div>

<h5 id="数据类型">数据类型</h5>

<ol>
  <li>数值类型
a. 整型
    <ul>
      <li>tinyint：bool</li>
      <li>smallint</li>
      <li>mediumint</li>
      <li>int</li>
      <li>bigint</li>
      <li>int(M位数)
b. 浮点型</li>
      <li>float(M, D小数位数)</li>
      <li>double(M, D)
c. 定点数</li>
      <li>decimal(M, D)：保存精确值，不同于浮点数的四舍五入</li>
    </ul>
  </li>
  <li>
    <p>字符串类型
a. char, varchar(65535\)
b. blob, text
c. binary, varbinary</p>
  </li>
  <li>日期时间类型
    <ul>
      <li>datetime</li>
      <li>date</li>
      <li>timestamp</li>
      <li>time</li>
      <li>year</li>
    </ul>
  </li>
  <li>枚举和集合
    <ul>
      <li>enum(v1, …)</li>
      <li>set(v1, …)</li>
    </ul>
  </li>
</ol>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE TABLE tab ( gender SET('man', 'woman', 'no') );
INSERT INTO tab VALUES ('man', 'man');
</code></pre></div></div>

<h5 id="列属性列约束">列属性/列约束</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- PRIMARY 主键
create table tab ( id INT, stu VARCHAR(10), PRIMARY KEY (id) );
create table tab ( id int, stu varchar(10), age int, primary key (stu, age));

- UNIQUE 唯一索引（唯一约束）:使某字段的值也不能重复
- NULL 约束：表示当前列是否可以为null
- DEFAULT：当前字段的默认值
- AUTO_INCREMENT 自动增长约束：必须为索引（主键或unique），只能存在一个字段，默认为1开始，通过表属性 auto_increment = x设置
- COMMENT 注释
- FOREIGN KEY 外键约束

</code></pre></div></div>

<h5 id="select">SELECT</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- FROM 子句
SELECT * FROM tb1, tb2;

- WHERE 子句：运算符
=, &lt;=&gt;, &lt;&gt;, !=, &lt;=, &lt;, &gt;=, &gt;, !, &amp;&amp;, ||,
in (not) null, (not) like, (not) in, (not) between and, is (not), and, or, not, xor
is/is not 加上ture/false/unknown，检验某个值的真假
&lt;=&gt;与&lt;&gt;功能相同，&lt;=&gt;可用于null比较

- GROUP BY 分组子句
    count 返回不同的非NULL值数目  count(*)、count(字段)
    sum 求和
    max 求最大值
    min 求最小值
    avg 求平均值
    group_concat 返回带有来自一个组的连接的非NULL值的字符串结果。组内字符串连接。
    
- HAVING 条件子句：对筛选出的结果再次过滤

- ORDER BY 排序子句
    order by 排序字段/别名 排序方式 [,排序字段/别名 升序ASC/降序DESC]...

- LIMIT 限制结果数量子句
- DISTINCT, ALL 选项：去除重复记录
</code></pre></div></div>

<h5 id="存储过程">存储过程</h5>

<p>存储过程：是一段可执行性代码的集合。相比函数，更偏向于业务逻辑。</p>

<h5 id="触发器">触发器</h5>

<h3 id="sql语句优化">SQL语句优化</h3>

<h3 id="索引锁机制">索引、锁机制</h3>

<p>索引：是一种用于快速查询和检索数据的数据结构。常见的索引结构有: B 树， B+树和 Hash。相当于目录的作用。</p>

<p>优点：大大加快 数据的检索速度</p>

<p>缺点 ：创建和维护索引需要耗费许多时间。当对表中的数据增删改时，如果数据有索引，则需要动态修改，会降低 SQL 执行效率。</p>

<h5 id="hash表">Hash表</h5>

<p>哈希算法</p>
<ol>
  <li>哈希冲突
    <ul>
      <li>链地址法</li>
      <li>红黑树</li>
    </ul>
  </li>
  <li>最大缺点是Hash 索引不支持顺序和范围查询</li>
</ol>

<h5 id="b-tree多路平衡查找树">B-Tree/多路平衡查找树</h5>

<p>B 树 VS B+树：</p>
<ul>
  <li>节点：B 树的所有节点存放键和数据，而 B+树只有叶子节点存放 key 和 data，其他内节点只存放 key。</li>
  <li>叶子节点：B 树的叶子节点是独立的;B+树的叶子节点有引用链指向相邻的叶子节点。</li>
  <li>查找：B 树的检索相当于对节点的关键字做二分查找，可能不到叶子节点就找到；而 B+树的查找是从根节点到叶子节点。</li>
</ul>

<h5 id="索引类型">索引类型</h5>

<ol>
  <li>主键索引</li>
  <li>二级索引/辅助索引
    <ul>
      <li>唯一索引</li>
      <li>普通索引</li>
      <li>前缀索引</li>
      <li>全文索引</li>
    </ul>
  </li>
</ol>

<p>聚集索引：索引结构和数据一起存放的索引。如主键索引。</p>

<p>非聚集索引：索引结构和数据分开存放的索引。如二级索引。</p>

<p>覆盖索引：索引包含/覆盖所有需要查询的字段的值</p>

<h5 id="mysql添加索引">MySQL添加索引</h5>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. 添加 主键索引
ALTER TABLE `table_name` ADD PRIMARY KEY ( `col` )

2.添加 唯一索引
ALTER TABLE `table_name` ADD UNIQUE ( `col` )

3.添加 普通索引
ALTER TABLE `table_name` ADD INDEX index_name ( `col` )

4.添加 全文索引
ALTER TABLE `table_name` ADD FULLTEXT ( `col`)

5.添加多列索引
ALTER TABLE `table_name` ADD INDEX index_name ( `col1`, `col2` )
</code></pre></div></div>

<h3 id="数据库设计步骤">数据库设计步骤</h3>

<ul>
  <li>需求分析 : 包括数据、功能和性能需求。</li>
  <li>概念结构设计 : 主要采用 E-R 模型进行设计，包括画 E-R 图。</li>
  <li>逻辑结构设计 : 通过将 E-R 图转换成表，实现从 E-R 模型到关系模型的转换。</li>
  <li>物理结构设计 : 为设计的数据库选择合适的存储结构和存取路径。</li>
  <li>数据库实施 : 包括编程、测试和试运行</li>
  <li>数据库的运行和维护 : 系统的运行与数据库的日常维护。</li>
</ul>

<h5 id="数据库基本设计规范">数据库基本设计规范</h5>

<h5 id="字段设计规范">字段设计规范</h5>

<h3 id="字符集">字符集</h3>

<p>数据库和表的字符集统一使用 UTF8，兼容性更好</p>

<h3 id="mysql基础">MySQL基础</h3>

<p>关系型数据库：用于持久化存储 系统中的一些数据，是一种建立在关系模型基础上的数据库。关系模型表明了数据库中存储的数据间的联系（一对一、一对多、多对多）。</p>

<h3 id="存储引擎">存储引擎</h3>

<p>MyISAM 引擎 VS InnoDB引擎：</p>

<p>Innodb 支持事务，支持行级锁，更好的恢复性，高并发下性能更好。</p>

<ul>
  <li>行级锁：MyISAM 只有表级锁（对整张表加锁，不利于并发写），而 InnoDB 支持行级锁和表级锁。</li>
  <li>事务：MyISAM 不支持；InnoDB 支持，能提交(commit)和回滚(rollback)事务。</li>
  <li>外键：MyISAM 不支持，而 InnoDB 支持。</li>
  <li>数据库异常崩溃后的安全恢：MyISAM 不支持，而 InnoDB 支持。</li>
  <li>MVCC（行级锁的一个升级）：MyISAM 不支持，而 InnoDB 支持。</li>
</ul>

<h3 id="查询缓存">查询缓存</h3>

<h3 id="事务">事务</h3>

<p>事务：是逻辑上的一组操作，要么都执行，要么都不执行。如转钱与收钱。</p>

<p>数据库事务：多个对数据库的操作（SQL 语句）要么全部执行成功,要么全部不执行 。</p>

<h5 id="事务的四大特性acid">事务的四大特性(ACID)</h5>

<ol>
  <li>原子性（Atomicity）：事务是最小的执行单位，不允许分割。确保动作要么全部完成，要么完全不起作用；MySQL InnoDB 引擎用undo log(回滚日志) 保证。</li>
  <li>一致性（Consistency）：执行事务前后，数据保持一致；</li>
  <li>隔离性（Isolation）：并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务间数据库是独立的；MySQL InnoDB 引擎通过 锁机制、MVCC 等</li>
  <li>持久性（Durability）：一个事务被提交后，对数据库中数据的改变是持久的，即使数据库发生故障也不应有影响。MySQL InnoDB 引擎用 redo log(重做日志)保证</li>
</ol>

<h5 id="并发事务带的问题">并发事务带的问题</h5>

<ul>
  <li>脏读</li>
  <li>丢失修改</li>
  <li>不可重复读</li>
  <li>幻读</li>
</ul>

<h5 id="隔离级别">隔离级别</h5>

<ol>
  <li>READ-UNCOMMITTED(读取未提交)： 最低，允许读取尚未提交的数据变更；可能导致脏读、幻读或不可重复读。</li>
  <li>READ-COMMITTED(读取已提交)： 允许读取并发事务已提交的数据；可阻止脏读，但幻读或不可重复读仍有可能发生。</li>
  <li>REPEATABLE-READ(可重复读)： 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改；可阻止脏读和不可重复读，但幻读仍有可能发生。MySQL InnoDB 存储引擎的默认支持的隔离级别</li>
  <li>SERIALIZABLE(可串行化)： 最高，完全服从 ACID 。所有的事务依次逐个执行，事务间完全不可能产生干扰；该级别可防止脏读、不可重复读以及幻读。</li>
</ol>

<h3 id="mysql三大日志">MySQL三大日志</h3>

<ul>
  <li>binlog（归档日志）：是物理日志，记录内容是”在某个数据页上做了什么修改”。用于数据备份</li>
  <li>redo log（重做日志）：InnoDB独有，让InnoDB引擎有了崩溃恢复能力。用于MySQL 实例挂了或宕机</li>
  <li>undo log（回滚日志）：发生异常时，对已执行的操作进行回滚。用于实现MVCC</li>
</ul>

<h3 id="分库分表">分库分表：</h3>
<p>MyCAT
Sharding-JDBC
Sharding-Sphere</p>
